"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{2133:(e,t,r)=>{r.d(t,{ToastProvider:()=>s,d:()=>i});var o=r(5155),n=r(2115);let a=(0,n.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,n.useState)([]),i=e=>{s(t=>t.filter(t=>t.id!==e))};return(0,o.jsxs)(a.Provider,{value:{toasts:r,toast:e=>{let{title:t,description:r,duration:o=3e3}=e,n=Math.random().toString(36).substring(2,9),a={id:n,title:t,description:r,duration:o};s(e=>[...e,a]),o>0&&setTimeout(()=>{i(n)},o)},dismiss:i},children:[t,(0,o.jsx)(l,{})]})}function l(){let e=(0,n.useContext)(a);if(!e)return null;let{toasts:t,dismiss:r}=e;return 0===t.length?null:(0,o.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:t.map(e=>(0,o.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-sm w-full animate-in fade-in slide-in-from-bottom-5 border border-gray-200 dark:border-gray-700",children:(0,o.jsxs)("div",{className:"flex justify-between items-start",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),e.description&&(0,o.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:e.description})]}),(0,o.jsx)("button",{onClick:()=>r(e.id),className:"ml-4 inline-flex text-gray-400 focus:outline-none focus:text-gray-500 rounded-lg p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700",children:"\xd7"})]})},e.id))})}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},4270:(e,t,r)=>{r.d(t,{SurveyProvider:()=>_,Y:()=>f});var o=r(5155),n=r(2115),a=r(4595),s=r(7058);let l={RESPONSE_ID:"survey_response_id"},i=()=>"response_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),c=()=>{let e=localStorage.getItem(l.RESPONSE_ID);return e||(e=i(),localStorage.setItem(l.RESPONSE_ID,e)),e},g=async(e,t)=>{try{let r=c();if(!r)return;let o=(0,s.H9)((0,s.rJ)(a.db,"responses"),r);return(await (0,s.x7)(o)).exists()?await (0,s.mZ)(o,{...e,"user_info.last_updated":(0,s.O5)(),"user_info.completion_percentage":u(e),"user_info.current_section":t}):await (0,s.BN)(o,{user_info:{session_id:r,start_time:(0,s.O5)(),last_updated:(0,s.O5)(),completion_status:"in_progress",completion_percentage:u(e),current_section:t},...e}),r}catch(e){return console.error("Error saving survey responses:",e),c()}},u=e=>Math.round(Object.keys(e).length/7*100),d=async e=>{try{let t=(0,s.H9)((0,s.rJ)(a.db,"responses"),e);return await (0,s.mZ)(t,{"user_info.completion_status":"completed","user_info.completion_percentage":100,"user_info.completion_time":(0,s.O5)()}),!0}catch(e){return console.error("Error marking survey as completed:",e),!0}},m={RESPONSES:"kreo_survey_responses",CURRENT_SECTION:"kreo_survey_current_section",LEFT_PAGE:"survey_left_page",RESPONSE_ID:"survey_response_id",FIRST_TIME:"survey_first_time"},S=(0,n.createContext)(void 0);function _(e){let{children:t}=e,[r,a]=(0,n.useState)(0),[s,l]=(0,n.useState)({}),[i,c]=(0,n.useState)(!1),[u,_]=(0,n.useState)(!1),[f,p]=(0,n.useState)(null),E=(0,n.useRef)(null),h=()=>{var e;let t=null===(e=s.demographics)||void 0===e?void 0:e.age;return t?"Under 18"===t?"demographics_under18":"18-24"===t?"demographics_18to24":"demographics_25plus":"demographics"},v=()=>{var e,t;let r=null===(e=s.demographics)||void 0===e?void 0:e.age,o=null===(t=s.demographics)||void 0===t?void 0:t.gender;if(!r||!o)return console.log("Missing age or gender, using default section"),"gaming_family_under18_male";console.log("Determining family section for:",{age:r,gender:o});let n="female"===o.toLowerCase();if("Under 18"===r){let e=n?"gaming_family_under18_female":"gaming_family_under18_male";return console.log("Selected section for Under 18:",e),e}if("18-24"===r){let e=n?"gaming_family_18to24_female":"gaming_family_18to24_male";return console.log("Selected section for 18-24:",e),e}let a=n?"gaming_family_25plus_female":"gaming_family_25plus_male";return console.log("Selected section for 25+:",a),a},y=()=>{let e=["demographics",h(),"gaming_preferences","gaming_habits","gaming_lifestyle",v(),"future_gaming"];return console.log("Section order determined:",e),e},I=(0,n.useCallback)(async()=>{i&&(localStorage.setItem(m.RESPONSES,JSON.stringify(s)),localStorage.setItem(m.CURRENT_SECTION,y()[r]),localStorage.setItem(m.LEFT_PAGE,"true"),await N())},[s,r,i]);(0,n.useEffect)(()=>{{let e=e=>{"beforeunload"===e.type&&(localStorage.setItem(m.LEFT_PAGE,"true"),localStorage.setItem(m.RESPONSES,JSON.stringify(s)),localStorage.setItem(m.CURRENT_SECTION,y()[r]))};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}},[s,r]),(0,n.useEffect)(()=>{try{localStorage.getItem(m.FIRST_TIME)||localStorage.setItem(m.FIRST_TIME,"true");let e=localStorage.getItem(m.RESPONSES);e&&l(JSON.parse(e));let t=localStorage.getItem(m.CURRENT_SECTION);if(t){let e=y().indexOf(t);-1!==e&&a(e)}}catch(e){console.error("Error loading saved survey data:",e)}c(!0)},[]),(0,n.useEffect)(()=>(i&&(localStorage.setItem(m.RESPONSES,JSON.stringify(s)),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{N()},1e4)),()=>{E.current&&clearTimeout(E.current)}),[s,i]),(0,n.useEffect)(()=>{i&&(localStorage.setItem(m.CURRENT_SECTION,y()[r]),N())},[r,i]);let N=async()=>{if(0!==Object.keys(s).length){_(!0);try{await g(s,y()[r]),p(new Date)}catch(e){console.error("Error saving to Firebase:",e)}finally{_(!1)}}},x=y()[r],O=r===y().length-1;return(0,o.jsx)(S.Provider,{value:{currentSection:x,responses:s,setCurrentSection:e=>{let t=y().indexOf(e);-1!==t&&a(t)},updateResponses:(e,t)=>{l(r=>{let o={...r,[e]:t};return i&&localStorage.setItem(m.RESPONSES,JSON.stringify(o)),o})},isLastSection:O,goToNextSection:()=>{console.log("goToNextSection called");let e=y(),t=e[r];if(console.log("Current section index:",r),console.log("Section order:",e),console.log("Current section:",t),r<e.length-1){if("demographics"===t){let t=h();console.log("Going to demographic section:",t),a(e.indexOf(t))}else{let t=r+1,o=e[t];console.log("Going to next section, new index:",t),console.log("Next section:",o),a(t)}}else if(r===e.length-1){console.log("This is the last section, marking as completed");let e=localStorage.getItem(m.RESPONSE_ID);e&&d(e)}I()},goToPreviousSection:()=>{let e=y();r>0&&(["demographics_under18","demographics_18to24","demographics_25plus"].includes(x)?a(e.indexOf("demographics")):a(e=>e-1))},resetSurvey:()=>{for(let e in localStorage.removeItem(m.RESPONSES),localStorage.removeItem(m.CURRENT_SECTION),localStorage.removeItem(m.RESPONSE_ID),localStorage.removeItem(m.LEFT_PAGE),localStorage)(e.startsWith("kreo_")||e.startsWith("survey_"))&&localStorage.removeItem(e);l({}),a(0),p(null)},isSaving:u,lastSaved:f,getDemographicSection:h,getFamilySection:v,getSectionOrder:y,forceSave:I},children:t})}function f(){let e=(0,n.useContext)(S);if(void 0===e)throw Error("useSurvey must be used within a SurveyProvider");return e}},4595:(e,t,r)=>{r.d(t,{db:()=>l,j:()=>i});var o=r(9904),n=r(7058),a=r(4565);let s=0===(0,o.Dk)().length?(0,o.Wp)({apiKey:"AIzaSyASvnePd7RJ6RmwvyZvhE040t9MHnPqgVE",authDomain:"howindiagames.firebaseapp.com",projectId:"howindiagames",storageBucket:"howindiagames.firebasestorage.app",messagingSenderId:"450815957892",appId:"1:450815957892:web:31c8c6c026712d1599dbd1"}):(0,o.Dk)()[0],l=(0,n.aU)(s),i=(0,a.xI)(s)}}]);